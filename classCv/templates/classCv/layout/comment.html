
{% extends "header.html" %}
{% load static %}

{% block content %}
<div class="cont">
    <h2>Analyse de Sentiment des Commentaires</h2>

    <div class="comment-section">
        <form id="comment-form" method="POST">
            {% csrf_token %}
            <label for="comment">Entrez votre commentaire :</label>
            <textarea id="comment" name="comment" rows="4" placeholder="Tapez votre commentaire ici..."></textarea>
            <button type="submit" class="btn-submit">Envoyer</button>
        </form>
    </div>

    <div class="result" id="result-section" style="display: none;">
        <h3>Résultat de l'analyse :</h3>
        <p id="result-message"></p>
    </div>
</div>

<!-- Style (CSS) -->
<style>
    .cont {
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
        text-align: center;
        color: #333;
    }

    .comment-section {
        margin: 20px 0;
    }

    textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: none;
        margin-bottom: 10px;
    }

    .btn-submit {
        display: inline-block;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-submit:hover {
        background-color: #45a049;
    }

    .result {
        margin-top: 20px;
    }

    #result-message {
        font-size: 18px;
        color: #333;
    }
</style>

<script>
    document.getElementById('comment-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Empêche le rechargement de la page

        let formData = new FormData(this);

        fetch("{% url 'comments' %}", {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest', // Assure que la requête est détectée comme Ajax
                'X-CSRFToken': '{{ csrf_token }}',
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if(data.success) {
                document.getElementById('result-message').innerText = data.message;
                document.getElementById('result-section').style.display = 'block';
            } else {
                console.error(data.error);
            }
        })
        .catch(error => console.error('Error:', error));
    });
</script>
{% endblock %}
